---
title: "L01 Introduction"
subtitle: "Data Visualization (STAT 302)" 
author: "Jingyang Zhang"
output:
  html_document:
    toc: true
    toc_float: true
    highlight: "tango"
---

## Overview

The goals of this lab are to (1) ensure that the major software for this course is properly installed and functional, (2) develop and follow a proper workflow, and (3) work together to construct a few plots to explore a dataset using `ggplot2` --- demonstration of the utility and power of `ggplot2`. 

**Don't worry if you cannot do everything here by yourself.** You are just getting started and the learning curve is steep, but remember that the instructional team and your classmates will be there to provide support. Persevere and put forth an honest effort and this course will payoff.

```{r load-packages, warning=FALSE, message=FALSE}
# Load package(s) - We will do this together

library(tidyverse)
library(ggstance)
library(skimr)
```

<br>

## Dataset

We'll be using data from the [**lego** package](https://github.com/seankross/lego) which is already in the `/data` subdirectory, along with many other processed datasets, as part of the zipped folder for this lab. 


<br><br>

## Tasks
Complete the following tasks. For many of these you'll need to simply indicate that you have completed the task. In others, you'll need to run some R code and/or supply a sentence or two.

<br><br>

### Task 1

Download and install [R Software](https://cran.rstudio.com/).

__DONE__

<br><br>

### Task 2

1. Download and install [RStudio](https://www.rstudio.com/products/rstudio/download4/).
2. Open RStudio and ensure it and R have been properly installed. 
3. Go to **Tools** > **Global Options** and change the two indicated settings below and click **Applly**.

![](screen_shot/rstudio-workspace.png)
<strong>DONE</strong>

<br>

### Task 3
Install the following packages:

- `tidyverse`
- `ggstance`
- `skimr`

__DONE__

<br><br>

### Task 4

1. Download `data_vis_labs.zip` from Canvas. 
2. Unzip the file and place the unzipped `data_vis_labs` directory where you would like to keep all of your lab work for this course.
3. Open RStudio and create a project folder for this *exsisting directory*.  
4. Appropriately rename `template_L01.Rmd` for submission (e.g. *Kuper_Arend_L01.Rmd*).
5. Compile the *_L01.Rmd file with `Cmd/Ctrl + Shift + K`.

__DONE__

<br><br>

### Task 5 
Optional: It is always handy to have a versatile text editor and I would suggest downloading [Sublime Text](https://www.sublimetext.com/). It is free to use.
<strong>DONE</strong>

<br><br>

## Exercise 1

Let's look at some interesting patterns in the history of LEGO! We'll be using data from the [**lego** package](https://github.com/seankross/lego) located `data/legosets.rda`. We will work through this exercise together in class.

<br><br>

### Inspect the data

The **lego** package provides a helpful dataset some interesting variables. Let's take a quick look at the data.
```{r}
load(file="data/legosets.rda")

skim(legosets)
```


<br><br>

### Price per year

First, let's look at the average cost of LEGO sets over time. The main variable of interest here is `USD_MSRP`, or the manufacturer's suggested retail price in constant dollars (i.e. not adjusted for inflation).

```{r}
# Overall mean cost
mean_cost=mean(legosets$USD_MSRP, na.rm = TRUE)

mean_cost

# Mean cost by year

mean_cost_yr=legosets %>% 
  group_by(Year) %>%
  summarise(
   count=n(),
   sum=sum(USD_MSRP, na.rm=TRUE),
   mean=mean(USD_MSRP, na.rm=TRUE)
  )

mean_cost_yr


```


<br><br>

### Pieces per year

Next, let’s look at how the number of pieces per set has changed over time. Because Duplo sets are much smaller (since they’re designed for toddlers), we’ll make a special indicator variable for them.

```{r}

# Overall mean pieces
mean_pieces=mean(legosets$Pieces, na.rm = TRUE)

mean_pieces

# Mean pieces by year

mean_pieces_yr=legosets %>% 
  group_by(Year) %>%
  summarise(
   count=n(),
   sum=sum(Pieces, na.rm=TRUE),
   mean=mean(Pieces, na.rm=TRUE)
  )

mean_pieces_yr



```


Looking at Duplo v.s. Non-Duplo
```{r}

# Create indicator variable for Duplo
legosets$duplo=with(legosets, ifelse(Theme=="Duplo", 1, 0))

# Mean cost by year without Duplor

mean_cost_yr_nodup=legosets %>% 
  filter(duplo==0) %>%
  group_by(Year) %>%
  summarise(
   count_nodup=n(),
   mean_nodup=mean(USD_MSRP, na.rm=TRUE)
  )

mean_cost_yr_nodup

# Mean cost by year for just Duplor

mean_cost_yr_dup=legosets %>% 
  filter(duplo==1) %>%
  group_by(Year) %>%
  summarise(
   count_dup=n(),
   mean_dup=mean(USD_MSRP, na.rm=TRUE)
  )

mean_cost_yr_dup

cost_combo=merge(mean_cost_yr_nodup, mean_cost_yr_dup, by=1, all=TRUE)



# Mean pieces by year without duplo

mean_pieces_yr_nodup=legosets %>% 
  filter(duplo==0) %>%
  group_by(Year) %>%
  summarise(
   count_nodup=n(),
   mean_nodup=mean(Pieces, na.rm=TRUE)
  )

mean_pieces_yr_nodup








# Mean pieces by year without duplo

mean_pieces_yr_dup=legosets %>% 
  filter(duplo==1) %>%
  group_by(Year) %>%
  summarise(
   count_dup=n(),
   mean_dup=mean(Pieces, na.rm=TRUE)
  )

mean_pieces_yr_dup

pieces_combo=merge(mean_pieces_yr_nodup, mean_pieces_yr_dup, by=1, all=TRUE)





```


Visualize Mean Cost with or without Duplo

```{r}



p=ggplot()+
  geom_line(data=mean_cost_yr, aes(x=as.factor(Year), y=mean), color="red", linetype="dashed", size=1.5, group=1)+
  geom_line(data=mean_cost_yr_nodup, aes(x=as.factor(Year), y=mean), color="black", size=1.2, group=1)+
  labs(linetype="Themes")+
  theme(
    legend.position = c(0.95, 0.95),
    legend.justification = c("right", "top"),
    legend.box.just = "right",
    legend.margin = margin(6,6,6,6),
    axis.text.x=element_text(angle=90, hjust=1, size=7))
  


print(p)

```

?????? DUPLO?????

<br><br>

### LEGO set themes

In the 1990s, [LEGO began partnering with famous brands and franchises](https://www.cnbc.com/2018/04/27/lego-marketing-strategy-made-it-world-favorite-toy-brand.html) to boost its own sales. First, let's see how many different "themes" LEGO now offers:

```{r}
# List of unique themes
unique(legosets$Theme)

# Number of unique themes
length(unique(legosets$Theme)) #115

```





## Class Notes ##

__Types of Variables__

Categorical/Factor; Continuous/Numeric

__Two Questions to Ask Before Deciding the Graphics:__

1. How many variables? Uivariate or multivariate?

2. Type of variable(s)?


__When and why we use a ?__

1. Histogram: 

a. cts/numerical, can be discrete but cts works better

b. univariate


2. Boxplot: 5 summary of the data: min, 0.25 Percentile (first quadrat), Median (second quadrat), 0.75 Percentile (third quadrat), max

a. cts/numerical

b. univarite



3. Bar plot (or called frequency plot): how frequent does the category/factor level show up (measured by the height of the bar)

a. categorical/factor

b. univariate

c. Histogram and bar plot are for different types of variables:

(1) Histogram: for cts variable, usually does not have spaces in between bars

(2) Bar plot: for categorical variable, usually has spaces in between bars



4. Scatterplot: shows relathips between two numerical variables

a. cts/numerical

b. bivariate


5. Segmented/Stacked Bar Plot: shading categories within a bar (another categorical var)

a. categorical by categorical

b. bivariate



6. Side-by-Side/Grouped Boxplot: boxplots for multiple groups so we can compare

a. cts/numerical by categorical

b. bivariate



__We are able to take the above basic graphics and add additional aesthetics (i.e. information) and turn them to more than bivariate graphics (e.g. multivariate, showing relationships among more than 2 variables)__


```{r}
nmonths = 24
x = seq(as.Date("2015/1/1"), by = "month", length.out = nmonths)

prescription1 <- data.frame(
  x,
  Percent.Change = 25 + runif(nmonths,1,100)
)

prescription2 <- data.frame(
  x,
  Percent.Change = 75 + runif(nmonths,1,50)
)

cols = c("dates", "Difference")
colnames(prescription1) = cols
colnames(prescription2) = cols

p = ggplot() + 
  geom_line(data = prescription1, aes(x = dates, y = Difference), color = "blue") +
  geom_line(data = prescription2, aes(x = dates, y = Difference), color = "red") +
  xlab('Dates') +
  ylab('percent.change')

print(p)
```

