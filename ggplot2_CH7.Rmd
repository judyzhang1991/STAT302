---
title: "ggplot2_CH7"
author: "Jingyang(Judy) Zhang"
date: "4/27/2020"
output: html_document
---
# CH7 Positioning #

## 7.1 Introduction ##
```{r}
library(tidyverse)
library(reshape)
library(ggpubr)
library(nlme)

cdc <- read_delim(file = "data_vis_labs/data/cdc.txt", delim = "|") %>%
  mutate(genhlth = factor(genhlth,
    levels = c("excellent", "very good", "good", "fair", "poor")
  ))
```


1. There are four components that control position:

a. __Position Adjustments__: adjust the position of overlapping objects within a layer. These are most useful for bar and other interval geoms, but can be useful in other situations. 

b. __Position Scales__: control how the values in the data are mapped to positions on the plot. 

c. __Facetting__: a mechanis for automatically laying out multiple plots on a page. It splits the data into subsets, and then plots each subset in a different panel. Such plots are often called small multiples or trellis graphics. 

d. __Coordinate Systems__: control how the two independent position scales are combined to create a 2d coordinate system. The most common coordinate system is Cartesian, but other coordinate systems can be useful in special cirucumstances. 

## 7.2 Facetting ##

1. __Facetting__: generates small multiples each showing a different subset of the data. 

a. Small multiples are a powerful tool for exploratory data analysis: you can rapidly compare patterns in different parts of the data and see whether they are the same or different.

2. __Three Types of Facetting__:

a. ``facet_null()``: a single plot, the default.

b. ``facet_wrap()``: "wraps" a 1d ribbon of panels into 2d. 

c. ``facet_grid()``: produces a 2d grid of panels defined by variables which form the rows and columns. 

![](screenshots/ggplot2_figure7_1.png)


### 7.2.1 Facet Wrap ###

1. ``facet_wrap()``: makes a long ribbon of panels (generated by any number of variables) and wraps it into 2d. 
a. Useful when a single variable has many levels and want to arrange the plots in a more space efficient manner. 

b. Control how the ribbon is wrapped into a grid:

(1) ``dir.ncol`` and ``nrow``: control how many columns and rows (you only need to set one). 

(2) ``as.table``: controls whether the facets are laid out like a table (TRUE), with highest values at the bottom right, or a plot (FALSE), with the highest values at the top-right. 

(3) ``dir``: controls the direction of wrap: horizontal or vertical

```{r}
base <- ggplot(mpg, aes(displ, hwy)) +
  geom_blank() +
  xlab(NULL) +
  ylab(NULL)

base + facet_wrap(~class, ncol = 3)

base + facet_wrap(~class, ncol = 3, as.table = FALSE)


base + facet_wrap(~class, nrow = 3)

base + facet_wrap(~class, nrow = 3, dir = "v")
```



### 7.2.2 Facet Grid ###

1. ``facet_grid()``: lays out plots in a 2d grid, as defined by a formula:

a. ``. ~ a``: spreads the values of ``a`` across the columns. This direction facilitates comparisons of ``y`` position, because the vertical sclaes are aligned. 

```{r}
base + facet_grid(.~ cyl)

```

b. ``b ~ .``: spreads the values of ``b`` down the rows. This direction facilitates comparison of ``x`` poisition because the horziontal scales are aligned. This makes it particularly useful for comparing distributions. 

```{r}
base + facet_grid(drv ~ .)
```


c. ``a ~ b``: spreads ``a`` across columns and ``b`` down rows. Usually want to put the variable with the greatest number of levels in the columns, to take advantage of the aspect ratio of your screen. 

```{r}
base + facet_grid(drv ~ cyl)
```


d. ``a + b ~ c + d``: can use multiple variables in the rows or columns by "adding" them together. 

(1) Variables appearing together on the rows or columns are nested in the sense that only combinations that appear in the data will appear in the plot.

(2) Variables that are specified on rows and columns will be crossed: all combinations will be shown, including those that didnt appear in the original dataset: this may result in empty panels. 


### 7.2.3 Controlling Scales ##
1. For both ``facet_wrap()`` and ``facet_grid()`` you can control whether the position scales are the same in all panels (__fixed__) or allow to vary between panels (__free__) with the __scale__ paramter:

a. ``scales = "fixed"``: ``x`` and ``y`` scales are fixed across all panels. 

b. ``scales = "free_x"``: the ``x`` scale is free, and the ``y`` scale is fixed. 

c. ``scales = "free_y"``: the ``y`` scale is free, and the ``x`` scale is fixed. 

d. ``scales = "free"``: ``x`` and ``y`` scales vary across panels. 

2. ``facet_grid()`` imposes an additional constraint on the scales: ALL panels in a __column__ must have the SAME X SCALE, and ALL palnels in a __row__ must have the SAME Y SCALE. This is because each column shares ONE ``x`` axis, and each row shares ONE ``y`` axis. 

3. __Fixed scales__ make it easier to see patterns across panels; __Free scales__ make it easir to see patterns within panels. 

```{r}
p <- ggplot(mpg, aes(cty, hwy)) + 
  geom_abline() +
  geom_jitter(width = 0.1, height = 0.1)

p + facet_wrap(~cyl)

p + facet_wrap(~cyl, scales = "free")

```


4. __Free scales__ are also useful when display multiple time series that were measured on different scales. 

```{r}
ggplot(economics_long, aes(date, value)) +
  geom_line() +
  facet_wrap(~variable, scales = "free_y", ncol = 1)
```


5. __Space__: an additional parameter in ``facet_grid()``. ``space`` takes the same values as ``scales`` (i.e. "free" and "fixed"). 

a. When ``space`` is "free", each column or row will have width or height proportional to the range of the scale for that column or row. This makes the scaling equal across the who plot: 1 cm on each panel maps to the same range of data. 
(1) Example: panel ``a`` had range 2 and panel ``b`` had range 4: $\frac{1}{3}$ of the space would be given to ``a``, and $\frac{2}{3}$ of the space would be given to ``b``. 

(2) This is most useful for categorical scales, where we can assign space proportionally based on the number of levels in each facet. 

```{r}
mpg$model <- reorder(mpg$model, mpg$cty)

mpg$manufacturer <- reorder(mpg$manufacturer, -mpg$cty)

ggplot(mpg, aes(cty, model)) +
  geom_point() +
  facet_grid(manufacturer ~ ., scales = "free", space = "free") +
  theme(strip.text.y = element_text(angle = 0))
```


## Reading Quiz 7 ##

Q1
```{r}
ggplot(cdc, aes(height, weight)) +
  geom_point() +
  facet_wrap(~genhlth, ncol = 2, dir = "v")
  
```



Q2
```{r}
# Option 1
ggplot(cdc, aes(height, weight)) +
  geom_point() +
  facet_grid(genhlth ~ smoke100)


# Option 2
ggplot(cdc, aes(height, weight)) +
  geom_point() +
  facet_grid(smoke100 ~ genhlth)


# Option 3
ggplot(cdc, aes(height, weight)) +
  geom_point() +
  facet_grid(genhlth ~ smoke100, scale = "free")


# Option 2
ggplot(cdc, aes(height, weight)) +
  geom_point() +
  facet_grid(smoke100 ~ genhlth, scale = "free")

  
```


Q4

```{r}
cdc2 <- dplyr::select(cdc, -gender)

ggplot(cdc, aes(height, weight)) +
  geom_point(data = cdc2, color = "grey70") +
  geom_point(aes(color = gender)) + 
  facet_wrap(~gender)
```




Q5
```{r}
ggplot(cdc, aes(weight, wtdesire)) + 
  geom_point() +
  geom_smooth()


# Option 1: x and y aesthetic switched
ggplot(cdc, aes(wtdesire, weight)) + 
  geom_point() +
  geom_smooth()


# Option 2: Coord flipped
ggplot(cdc, aes(weight, wtdesire)) + 
  geom_point() +
  geom_smooth() + 
  coord_flip()
```

